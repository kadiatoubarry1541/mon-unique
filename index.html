<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notre Site Mon Ablaye</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-images"></i> Nos images</h1>
            <p class="subtitle">Publie et consulte nos photos, vidéos et audios à tout moment </p>
        </header>
        
        <section class="upload-section">
            <div class="type-selector">
                <div class="type-btn active" data-type="all">
                    <i class="fas fa-images"></i> Tous
                </div>
                <div class="type-btn" data-type="photo">
                    <i class="fas fa-camera"></i> Photos
                </div>
                <div class="type-btn" data-type="video">
                    <i class="fas fa-video"></i> Vidéos
                </div>
                <div class="type-btn" data-type="audio">
                    <i class="fas fa-music"></i> Audios
                </div>
            </div>
            
            <div class="upload-box" id="dropZone">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>Déposons nos médias ici</h3>
                <p>Nos photos, vidéos et audios resteront disponibles ici !</p>
                <label for="mediaInput" class="file-label">
                    <i class="fas fa-folder-open"></i> Sélectionner un média
                </label>
                <input type="file" id="mediaInput" accept="image/*,video/*,audio/*" class="file-input">
                <div class="file-info">
                    Formats acceptés: JPG, PNG, GIF, MP4, WEBM, MOV, MP3, WAV | Taille maximale: <strong>500 Mo</strong>
                </div>
            </div>
            
            <div class="media-details">
                <div class="form-group">
                    <label for="mediaTitle"><i class="fas fa-heading"></i> Titre du média:</label>
                    <input type="text" id="mediaTitle" placeholder="Titre descriptif" class="form-input">
                </div>
                
                <div class="form-group">
                    <label for="mediaDescription"><i class="fas fa-align-left"></i> Description:</label>
                    <textarea id="mediaDescription" placeholder="Décrivez votre média..." class="form-input"></textarea>
                </div>
            </div>
            
            <div class="preview-container" id="previewContainer">
                <div class="preview-title">Aperçu de votre média:</div>
                <div class="preview-content" id="previewContent"></div>
            </div>
            
            <div class="storage-info">
                <div class="storage-header">
                    <i class="fas fa-database"></i> Espace de stockage utilisé
                </div>
                <div class="progress-container">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div class="storage-text" id="storageText">0 Mo / 500 Mo utilisés</div>
            </div>
            
            <button class="publish-btn" id="publishBtn">
                <i class="fas fa-paper-plane"></i> Publier le média
            </button>
        </section>
        
        <section class="published-media">
            <h2 class="section-title">
                <i class="fas fa-history"></i> Médias publiés
                <span id="mediaCount">(0)</span>
            </h2>
            <div class="media-grid" id="mediaGrid">
                <div class="no-media" id="noMediaMessage">
                    <i class="fas fa-box-open fa-3x" style="margin-bottom: 20px;"></i>
                    <p>Aucun média publié pour le moment</p>
                    <p>Commencez par publier votre premier média !</p>
                </div>
            </div>
        </section>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Média publié avec succès!</span>
    </div>

    <script>
        // Configuration de la base de données
        const DB_NAME = 'MediaDatabase';
        const STORE_NAME = 'medias';
        const MAX_STORAGE_MB = 500; // 500 Mo d'espace de stockage
        
        let db;
        let selectedMedia = null;
        let currentFilter = 'all';

        // Initialiser la base de données
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, 2);
                
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        // Créer le store pour les médias
                        const store = db.createObjectStore(STORE_NAME, { 
                            keyPath: 'id',
                            autoIncrement: true 
                        });
                        
                        // Créer des index pour faciliter les recherches
                        store.createIndex('title', 'title', { unique: false });
                        store.createIndex('date', 'date', { unique: false });
                        store.createIndex('type', 'type', { unique: false });
                    }
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    resolve();
                    updateStorageInfo();
                    loadMedias();
                };
                
                request.onerror = (event) => {
                    reject('Erreur IndexedDB: ' + event.target.error);
                };
            });
        }

        // Charger tous les médias
        function loadMedias(filter = 'all') {
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            let request;
            
            if (filter === 'all') {
                request = store.getAll();
            } else {
                const index = store.index('type');
                request = index.getAll(filter);
            }
            
            request.onsuccess = () => {
                const medias = request.result;
                renderMediaGrid(medias);
                
                // Mettre à jour le compteur de médias
                document.getElementById('mediaCount').textContent = `(${medias.length})`;
                
                if (medias.length === 0) {
                    document.getElementById('noMediaMessage').style.display = 'block';
                } else {
                    document.getElementById('noMediaMessage').style.display = 'none';
                }
            };
        }

        // Afficher la grille de médias
        function renderMediaGrid(medias) {
            const mediaGrid = document.getElementById('mediaGrid');
            mediaGrid.innerHTML = '';
            
            if (medias.length === 0) {
                document.getElementById('noMediaMessage').style.display = 'block';
                return;
            }
            
            // Trier les médias par date (les plus récentes en premier)
            medias.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            medias.forEach(media => {
                const mediaItem = createMediaItem(media);
                mediaGrid.appendChild(mediaItem);
            });
        }

        // Créer un élément média
        function createMediaItem(media) {
            const mediaItem = document.createElement('div');
            mediaItem.className = 'media-item';
            mediaItem.dataset.id = media.id;
            mediaItem.dataset.type = media.type;
            
            // Convertir les données binaires en Blob
            const blob = new Blob([media.fileData], { type: media.mimeType });
            const url = URL.createObjectURL(blob);
            
            let mediaContentHTML = '';
            
            if (media.type === 'photo') {
                mediaContentHTML = `
                    <div class="media-type-indicator">
                        <i class="fas fa-camera"></i> Photo
                    </div>
                    <img src="${url}" alt="${media.title}">
                `;
            } else if (media.type === 'video') {
                mediaContentHTML = `
                    <div class="media-type-indicator">
                        <i class="fas fa-video"></i> Vidéo
                    </div>
                    <video controls>
                        <source src="${url}" type="${media.mimeType}">
                        Votre navigateur ne supporte pas les vidéos.
                    </video>
                `;
            } else if (media.type === 'audio') {
                mediaContentHTML = `
                    <div class="media-type-indicator">
                        <i class="fas fa-music"></i> Audio
                    </div>
                    <audio controls>
                        <source src="${url}" type="${media.mimeType}">
                        Votre navigateur ne supporte pas les audios.
                    </audio>
                `;
            }
            
            mediaItem.innerHTML = `
                <div class="media-header">
                    <div class="media-title">${media.title || 'Sans titre'}</div>
                    <div class="media-date">Publié le: ${formatDate(media.date)}</div>
                </div>
                <div class="media-content">
                    ${mediaContentHTML}
                </div>
                <div class="media-footer">
                    <div class="media-size">${formatFileSize(media.size)}</div>
                    <button class="delete-btn" data-id="${media.id}">
                        <i class="fas fa-trash"></i> Supprimer
                    </button>
                </div>
            `;
            
            return mediaItem;
        }

        // Ajouter un média
        function addMedia(file, title, description) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    // Déterminer le type de média
                    let mediaType = '';
                    if (file.type.startsWith('image/')) mediaType = 'photo';
                    else if (file.type.startsWith('video/')) mediaType = 'video';
                    else if (file.type.startsWith('audio/')) mediaType = 'audio';
                    
                    const media = {
                        title: title,
                        description: description,
                        mimeType: file.type,
                        type: mediaType,
                        size: file.size,
                        date: new Date().toISOString(),
                        fileData: event.target.result // Données binaires du fichier
                    };
                    
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.add(media);
                    
                    request.onsuccess = () => {
                        // Ajouter l'ID généré automatiquement
                        media.id = request.result;
                        resolve(media);
                        showNotification(`${mediaType === 'photo' ? 'Photo' : mediaType === 'video' ? 'Vidéo' : 'Audio'} publié avec succès!`);
                        updateStorageInfo();
                        loadMedias(currentFilter);
                    };
                    
                    transaction.onerror = (event) => {
                        reject('Erreur lors de la publication: ' + event.target.error);
                    };
                };
                
                // Lire le fichier en tant qu'ArrayBuffer
                reader.readAsArrayBuffer(file);
            });
        }

        // Supprimer un média
        function deleteMedia(id) {
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);
            
            const request = store.delete(id);
            
            request.onsuccess = () => {
                showNotification('Média supprimé avec succès!');
                updateStorageInfo();
                loadMedias(currentFilter);
            };
        }

        // Mettre à jour les informations de stockage
        function updateStorageInfo() {
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            const request = store.getAll();
            
            request.onsuccess = () => {
                const medias = request.result;
                let totalSize = 0;
                
                medias.forEach(media => {
                    totalSize += media.size;
                });
                
                const totalMB = (totalSize / (1024 * 1024)).toFixed(2);
                const maxMB = MAX_STORAGE_MB;
                const percent = Math.min(100, (totalMB / maxMB) * 100);
                
                document.getElementById('storageText').textContent = 
                    `${totalMB} Mo / ${maxMB} Mo utilisés`;
                
                const progressFill = document.getElementById('progressFill');
                progressFill.style.width = `${percent}%`;
                progressFill.textContent = `${percent.toFixed(1)}%`;
                
                // Changer la couleur si le stockage est presque plein
                if (percent > 90) {
                    progressFill.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
                } else {
                    progressFill.style.background = 'linear-gradient(90deg, #4CAF50, #2E7D32)';
                }
            };
        }

        // Afficher une notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            
            if (isError) {
                notification.className = 'notification error';
            } else {
                notification.className = 'notification';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Formater la taille du fichier
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Formater la date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Afficher l'aperçu du média
        function showPreview(file) {
            const previewContainer = document.getElementById('previewContainer');
            const previewContent = document.getElementById('previewContent');
            
            previewContainer.style.display = 'block';
            previewContent.innerHTML = '';
            
            if (file.type.startsWith('image/')) {
                const imgElement = document.createElement('img');
                imgElement.src = URL.createObjectURL(file);
                imgElement.alt = "Aperçu de l'image";
                previewContent.appendChild(imgElement);
                
                // Ajouter un indicateur de type
                const typeIndicator = document.createElement('div');
                typeIndicator.className = 'media-type-indicator';
                typeIndicator.innerHTML = '<i class="fas fa-camera"></i> Photo';
                previewContent.appendChild(typeIndicator);
                
            } else if (file.type.startsWith('video/')) {
                const videoElement = document.createElement('video');
                videoElement.controls = true;
                videoElement.src = URL.createObjectURL(file);
                videoElement.style.maxWidth = '100%';
                videoElement.style.maxHeight = '400px';
                videoElement.style.borderRadius = '10px';
                previewContent.appendChild(videoElement);
                
                // Ajouter un indicateur de type
                const typeIndicator = document.createElement('div');
                typeIndicator.className = 'media-type-indicator';
                typeIndicator.innerHTML = '<i class="fas fa-video"></i> Vidéo';
                previewContent.appendChild(typeIndicator);
                
            } else if (file.type.startsWith('audio/')) {
                const audioElement = document.createElement('audio');
                audioElement.controls = true;
                audioElement.src = URL.createObjectURL(file);
                audioElement.style.width = '100%';
                previewContent.appendChild(audioElement);
                
                // Ajouter un indicateur de type
                const typeIndicator = document.createElement('div');
                typeIndicator.className = 'media-type-indicator';
                typeIndicator.innerHTML = '<i class="fas fa-music"></i> Audio';
                previewContent.appendChild(typeIndicator);
            }
        }

        // Initialisation de l'application
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                await initDB();
                
                // Événements de sélection de fichier
                document.getElementById('mediaInput').addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        selectedMedia = e.target.files[0];
                        
                        // Vérifier la taille du fichier
                        if (selectedMedia.size > MAX_STORAGE_MB * 1024 * 1024) {
                            showNotification(
                                `Le média dépasse la taille maximale de ${MAX_STORAGE_MB} Mo!`, 
                                true
                            );
                            return;
                        }
                        
                        showPreview(selectedMedia);
                    }
                });
                
                // Glisser-déposer
                const dropZone = document.getElementById('dropZone');
                
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('active');
                });
                
                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('active');
                });
                
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('active');
                    
                    if (e.dataTransfer.files.length > 0) {
                        const file = e.dataTransfer.files[0];
                        
                        // Vérifier que c'est un média accepté
                        if (!file.type.startsWith('image/') && 
                            !file.type.startsWith('video/') && 
                            !file.type.startsWith('audio/')) {
                            showNotification('Veuillez déposer un fichier image, vidéo ou audio!', true);
                            return;
                        }
                        
                        // Vérifier la taille
                        if (file.size > MAX_STORAGE_MB * 1024 * 1024) {
                            showNotification(
                                `Le média dépasse la taille maximale de ${MAX_STORAGE_MB} Mo!`, 
                                true
                            );
                            return;
                        }
                        
                        selectedMedia = file;
                        showPreview(selectedMedia);
                    }
                });
                
                // Bouton de publication
                document.getElementById('publishBtn').addEventListener('click', async () => {
                    if (!selectedMedia) {
                        showNotification('Veuillez sélectionner un média!', true);
                        return;
                    }
                    
                    const title = document.getElementById('mediaTitle').value.trim() || 'Mon média';
                    const description = document.getElementById('mediaDescription').value.trim() || '';
                    
                    try {
                        await addMedia(selectedMedia, title, description);
                        
                        // Réinitialiser le formulaire
                        selectedMedia = null;
                        document.getElementById('previewContainer').style.display = 'none';
                        document.getElementById('mediaTitle').value = '';
                        document.getElementById('mediaDescription').value = '';
                        document.getElementById('mediaInput').value = '';
                    } catch (error) {
                        console.error('Erreur:', error);
                        showNotification('Erreur: ' + error, true);
                    }
                });
                
                // Événement de suppression (délégation d'événements)
                document.getElementById('mediaGrid').addEventListener('click', (e) => {
                    if (e.target.closest('.delete-btn')) {
                        const btn = e.target.closest('.delete-btn');
                        const id = parseInt(btn.dataset.id);
                        if (confirm('Voulez-vous vraiment supprimer ce média?')) {
                            deleteMedia(id);
                        }
                    }
                });
                
                // Filtres par type de média
                document.querySelectorAll('.type-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        currentFilter = btn.dataset.type;
                        loadMedias(currentFilter);
                    });
                });
                
            } catch (error) {
                console.error('Erreur d\'initialisation:', error);
                showNotification('Erreur: ' + error, true);
            }
        });
    </script>
</body>
</html>


    

      
        
        <!-- Section du jeu -->
    <h1> L'HOMME DE MA VIE VIENS,AMUSONS_NOUS UN PEU </h1
     <p>Les condictions du jeu  et si tu veux ajouté plus fais moi signe</p>
    
      <p>1 les questions  sont vice versa donc tu dois savoir répondre mais  tu dois aussi te trouver  5 questions à mes posé. <br>
        2 on ne se fâche  pas,on échange  nos idées  donc zéro dispute  et chacun  dois se sentir  à l'aise et surtout libre.</p>
        <div class="game-section" id="game-section">
            <div class="game-container">
                <h2 class="game-title">Jeu de Partage</h2>
                <p class="game-description">
                    Ablay, Koolo et Invités - Partagez le dépôt de 50 000 selon vos performances
                </p>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de Partage - Ablay, Koolo et Invités</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
            color: #e0e0e0;
        }
        
        .accounts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .account {
            background: rgba(30, 30, 50, 0.8);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid transparent;
        }
        
        .account.active {
            border-color: #ffd700;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .account-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .account-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        
        .account.ablay .account-value { color: #4CAF50; }
        .account.koolo .account-value { color: #2196F3; }
        .account.depot .account-value { color: #FF9800; }
        .account.guest .account-value { color: #9C27B0; }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .game-panel {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .ablay-panel .panel-title { color: #4CAF50; }
        .koolo-panel .panel-title { color: #2196F3; }
        
        .panel-content {
            margin-top: 20px;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1.1rem;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        textarea:focus {
            outline: 2px solid #ffd700;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 10px;
            width: 100%;
        }
        
        .btn-primary { background: linear-gradient(to right, #4CAF50, #2E7D32); color: white; }
        .btn-secondary { background: linear-gradient(to right, #2196F3, #0D47A1); color: white; }
        .btn-tertiary { background: linear-gradient(to right, #9C27B0, #6A1B9A); color: white; }
        .btn-warning { background: linear-gradient(to right, #FF9800, #EF6C00); color: white; }
        
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active:not(:disabled) { transform: translateY(1px); }
        
        .btn-mode {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-mode.active {
            background: linear-gradient(to right, #ffd700, #ff9800);
            color: black;
            font-weight: bold;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .transaction-log {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .log-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ffd700;
        }
        
        .log-entry {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .log-entry.ablay { border-left: 4px solid #4CAF50; }
        .log-entry.koolo { border-left: 4px solid #2196F3; }
        .log-entry.guest { border-left: 4px solid #9C27B0; }
        .log-entry.system { border-left: 4px solid #ffd700; }
        
        .log-icon { font-size: 1.5rem; }
        .log-content { flex: 1; }
        .log-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .guest-section {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
        }
        
        .guest-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            color: #9C27B0;
        }
        
        .guest-input {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .guest-input input {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1.1rem;
        }
        
        .guests-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .guest-card {
            background: rgba(50, 30, 60, 0.8);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .guest-name { font-weight: 600; }
        .guest-amount { margin-left: auto; font-weight: 700; color: #9C27B0; }
        
        .transfer-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .money-transfer {
            background: rgba(30, 30, 50, 0.95);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            border: 3px solid #ffd700;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
        }
        
        .money-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            color: #ffd700;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .transfer-text {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: white;
        }
        
        .transfer-amount {
            font-size: 3.5rem;
            font-weight: 800;
            color: #4CAF50;
            text-shadow: 0 0 20px rgba(76, 175, 80, 0.7);
        }
        
        .negative {
            color: #F44336;
            text-shadow: 0 0 20px rgba(244, 67, 54, 0.7);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px 25px;
            margin-top: 30px;
            font-size: 1.1rem;
        }
        
        .turn-indicator {
            background: #ffd700;
            color: #000;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            animation: pulse 2s infinite;
        }
        
        .media-player {
            width: 100%;
            margin-top: 15px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .recording-indicator {
            display: none;
            color: #ff0000;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .recording-indicator .dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: #ff0000;
            border-radius: 50%;
            margin-right: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .mode-section {
            display: none;
        }
        
        .mode-section.active {
            display: block;
        }
        
        @media (max-width: 900px) {
            .game-container { grid-template-columns: 1fr; }
            .accounts-container { grid-template-columns: 1fr; }
            .actions { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-coins"></i> Jeu de Partage</h1>
            <p class="subtitle">Ablay, Koolo et Invités - Partagez le dépôt de 50 000 selon vos performances</p>
        </header>
        
        <div class="accounts-container">
            <div class="account ablay" id="ablay-account">
                <div class="account-title">
                    <i class="fas fa-crown"></i>
                    <span>Ablay</span>
                </div>
                <div class="account-value" id="ablay-amount">0 mille</div>
                <div>Solde: <span id="ablay-balance">0</span> mille</div>
            </div>
            
            <div class="account depot">
                <div class="account-title">
                    <i class="fas fa-piggy-bank"></i>
                    <span>Dépôt</span>
                </div>
                <div class="account-value" id="depot-amount">50 mille</div>
                <div>Total: <span id="depot-balance">50</span> mille</div>
            </div>
            
            <div class="account koolo" id="koolo-account">
                <div class="account-title">
                    <i class="fas fa-bullseye"></i>
                    <span>Koolo</span>
                </div>
                <div class="account-value" id="koolo-amount">0 mille</div>
                <div>Solde: <span id="koolo-balance">0</span> mille</div>
            </div>
            
            <div class="account guest" id="guest-account" style="display: none;">
                <div class="account-title">
                    <i class="fas fa-user-friends"></i>
                    <span id="guest-account-title">Invités</span>
                </div>
                <div class="account-value" id="guest-amount">0 mille</div>
                <div>Total: <span id="guest-balance">0</span> mille</div>
            </div>
        </div>
        
        <div class="guest-section">
            <div class="guest-header">
                <i class="fas fa-user-plus fa-2x"></i>
                <h2>Ajouter un invité</h2>
            </div>
            <div class="guest-input">
                <input type="text" id="guest-name" placeholder="Nom de l'invité">
                <button class="btn btn-tertiary" id="add-guest-btn">
                    <i class="fas fa-plus"></i> Ajouter invité
                </button>
            </div>
            <p>Les invités peuvent participer aux questions et gagner de l'argent !</p>
            <div class="guests-container" id="guests-list"></div>
        </div>
        
        <div class="game-container">
            <div class="game-panel ablay-panel">
                <div class="panel-header">
                    <i class="fas fa-user-circle fa-2x"></i>
                    <h2 class="panel-title" id="asker-title">Poseur de question</h2>
                </div>
                <div class="panel-content">
                    <div class="mode-selector">
                        <button class="btn-mode active" data-mode="text" data-type="question">Texte</button>
                        <button class="btn-mode" data-mode="audio" data-type="question">Audio</button>
                        <button class="btn-mode" data-mode="video" data-type="question">Vidéo</button>
                    </div>
                    
                    <div id="text-question-section" class="mode-section active">
                        <textarea id="ablay-question" placeholder="Écris ta question ici..."></textarea>
                    </div>
                    
                    <div id="audio-question-section" class="mode-section">
                        <button class="btn btn-primary" id="record-audio-btn">
                            <i class="fas fa-microphone"></i> <span id="audio-btn-text">Enregistrer une question audio</span>
                        </button>
                        <div class="recording-indicator" id="audio-recording-indicator">
                            <span class="dot"></span> Enregistrement en cours...
                        </div>
                        <audio id="audio-preview" controls class="media-preview"></audio>
                    </div>
                    
                    <div id="video-question-section" class="mode-section">
                        <button class="btn btn-primary" id="record-video-btn">
                            <i class="fas fa-video"></i> <span id="video-btn-text">Enregistrer une question vidéo</span>
                        </button>
                        <div class="recording-indicator" id="video-recording-indicator">
                            <span class="dot"></span> Enregistrement en cours...
                        </div>
                        <video id="video-preview" controls class="media-preview"></video>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="receiver-select">Destinataire :</label>
                        <select id="receiver-select" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); color: white; border: none; margin-top: 10px;">
                            <option value="koolo">Koolo</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" id="ask-btn">
                        <i class="fas fa-paper-plane"></i> Envoyer la question
                    </button>
                </div>
            </div>
            
            <div class="game-panel koolo-panel">
                <div class="panel-header">
                    <i class="fas fa-user-circle fa-2x"></i>
                    <h2 class="panel-title" id="responder-title">Répondant</h2>
                </div>
                <div class="panel-content">
                    <div id="question-display" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none;">
                        <strong>Question en cours :</strong> 
                        <div id="current-question"></div>
                    </div>
                    
                    <div class="mode-selector">
                        <button class="btn-mode active" data-mode="text" data-type="response">Texte</button>
                        <button class="btn-mode" data-mode="audio" data-type="response">Audio</button>
                        <button class="btn-mode" data-mode="video" data-type="response">Vidéo</button>
                    </div>
                    
                    <div id="text-response-section" class="mode-section active">
                        <textarea id="response-answer" placeholder="Écris ta réponse ici..." disabled></textarea>
                    </div>
                    
                    <div id="audio-response-section" class="mode-section">
                        <button class="btn btn-secondary" id="record-response-audio-btn" disabled>
                            <i class="fas fa-microphone"></i> <span id="response-audio-btn-text">Enregistrer une réponse audio</span>
                        </button>
                        <div class="recording-indicator" id="response-audio-recording-indicator">
                            <span class="dot"></span> Enregistrement en cours...
                        </div>
                        <audio id="response-audio-preview" controls class="media-player"></audio>
                    </div>
                    
                    <div id="video-response-section" class="mode-section">
                        <button class="btn btn-secondary" id="record-response-video-btn" disabled>
                            <i class="fas fa-video"></i> <span id="response-video-btn-text">Enregistrer une réponse vidéo</span>
                        </button>
                        <div class="recording-indicator" id="response-video-recording-indicator">
                            <span class="dot"></span> Enregistrement en cours...
                        </div>
                        <video id="response-video-preview" controls class="media-player"></video>
                    </div>
                    
                    <button class="btn btn-secondary" id="send-response-btn" disabled>
                        <i class="fas fa-share"></i> Envoyer la réponse
                    </button>
                </div>
            </div>
        </div>
        
        <div class="game-panel">
            <div class="panel-header">
                <i class="fas fa-check-circle fa-2x"></i>
                <h2 class="panel-title">Validation</h2>
            </div>
            <div class="panel-content">
                <div id="response-display" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none;">
                    <strong>Réponse reçue :</strong> 
                    <div id="current-response"></div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-primary" id="correct-btn" disabled>
                        <i class="fas fa-check-circle"></i> Bonne réponse
                    </button>
                    <button class="btn btn-warning" id="wrong-btn" disabled>
                        <i class="fas fa-times-circle"></i> Mauvaise réponse
                    </button>
                    <button class="btn" id="refuse-btn" style="background: linear-gradient(to right, #607D8B, #37474F);" disabled>
                        <i class="fas fa-ban"></i> Refuser la réponse
                    </button>
                </div>
            </div>
        </div>
        
        <div class="transaction-log">
            <div class="log-title">
                <i class="fas fa-clipboard-list"></i>
                <h2>Journal des transactions</h2>
            </div>
            <div id="log-entries">
                <div class="log-entry system">
                    <div class="log-icon"><i class="fas fa-info-circle"></i></div>
                    <div class="log-content">
                        <div class="log-header">
                            <span>Système</span>
                            <span>Maintenant</span>
                        </div>
                        <div>Bienvenue au jeu de partage ! Dépôt initial de 50 000 mille. Ablay doit poser une question.</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div><strong>Statut :</strong> <span id="game-status">En attente d'une question</span></div>
            <div><strong>Tour actuel :</strong> <span class="turn-indicator" id="turn-indicator">Ablay</span></div>
        </div>
    </div>
    
    <div class="transfer-animation" id="transfer-animation" style="display: none;">
        <div class="money-transfer">
            <div class="money-icon"><i class="fas fa-coins"></i></div>
            <div class="transfer-text">Transfert d'argent</div>
            <div class="transfer-amount" id="transfer-amount">+10 000</div>
        </div>
    </div>

    <script>
        // État du jeu
        const gameState = {
            depot: 50000,
            ablay: 0,
            koolo: 0,
            guests: [],
            currentQuestion: null,
            currentResponse: null,
            turn: 'ask',
            transactions: 0,
            currentAsker: 'ablay',
            currentResponder: null,
            currentMode: 'text',
            responseMode: 'text',
            players: ['ablay', 'koolo'],
            currentPlayerIndex: 0,
            mediaRecorder: null,
            recordedChunks: []
        };

        // Éléments DOM
        const DOM = {
            ablayAmount: document.getElementById('ablay-amount'),
            kooloAmount: document.getElementById('koolo-amount'),
            depotAmount: document.getElementById('depot-amount'),
            guestAmount: document.getElementById('guest-amount'),
            ablayAccount: document.getElementById('ablay-account'),
            kooloAccount: document.getElementById('koolo-account'),
            guestAccount: document.getElementById('guest-account'),
            askBtn: document.getElementById('ask-btn'),
            correctBtn: document.getElementById('correct-btn'),
            wrongBtn: document.getElementById('wrong-btn'),
            refuseBtn: document.getElementById('refuse-btn'),
            questionDisplay: document.getElementById('question-display'),
            currentQuestion: document.getElementById('current-question'),
            responseDisplay: document.getElementById('response-display'),
            currentResponse: document.getElementById('current-response'),
            logEntries: document.getElementById('log-entries'),
            turnIndicator: document.getElementById('turn-indicator'),
            gameStatus: document.getElementById('game-status'),
            transferAnimation: document.getElementById('transfer-animation'),
            transferAmount: document.getElementById('transfer-amount'),
            receiverSelect: document.getElementById('receiver-select'),
            askerTitle: document.getElementById('asker-title'),
            responderTitle: document.getElementById('responder-title'),
            responseAnswer: document.getElementById('response-answer'),
            guestsList: document.getElementById('guests-list'),
            guestAccountTitle: document.getElementById('guest-account-title'),
            sendResponseBtn: document.getElementById('send-response-btn'),
            addGuestBtn: document.getElementById('add-guest-btn'),
            recordAudioBtn: document.getElementById('record-audio-btn'),
            recordVideoBtn: document.getElementById('record-video-btn'),
            audioPreview: document.getElementById('audio-preview'),
            videoPreview: document.getElementById('video-preview'),
            recordResponseAudioBtn: document.getElementById('record-response-audio-btn'),
            recordResponseVideoBtn: document.getElementById('record-response-video-btn'),
            responseAudioPreview: document.getElementById('response-audio-preview'),
            responseVideoPreview: document.getElementById('response-video-preview'),
            audioRecordingIndicator: document.getElementById('audio-recording-indicator'),
            videoRecordingIndicator: document.getElementById('video-recording-indicator'),
            responseAudioRecordingIndicator: document.getElementById('response-audio-recording-indicator'),
            responseVideoRecordingIndicator: document.getElementById('response-video-recording-indicator'),
            audioBtnText: document.getElementById('audio-btn-text'),
            videoBtnText: document.getElementById('video-btn-text'),
            responseAudioBtnText: document.getElementById('response-audio-btn-text'),
            responseVideoBtnText: document.getElementById('response-video-btn-text')
        };

        // Initialisation du jeu
        function initGame() {
            updateUI();
            setupEventListeners();
            updatePlayerTurn();
            checkMediaPermissions();
        }

        // Vérifier les permissions pour l'audio et la vidéo
        async function checkMediaPermissions() {
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
            } catch (err) {
                addLog('system', 'Permissions audio/vidéo refusées. Certaines fonctionnalités seront limitées.');
                DOM.recordAudioBtn.disabled = true;
                DOM.recordVideoBtn.disabled = true;
                DOM.recordResponseAudioBtn.disabled = true;
                DOM.recordResponseVideoBtn.disabled = true;
            }
        }

        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            DOM.askBtn.addEventListener('click', askQuestion);
            DOM.correctBtn.addEventListener('click', () => validateAnswer('correct'));
            DOM.wrongBtn.addEventListener('click', () => validateAnswer('wrong'));
            DOM.refuseBtn.addEventListener('click', () => validateAnswer('refuse'));
            DOM.addGuestBtn.addEventListener('click', addGuest);
            DOM.sendResponseBtn.addEventListener('click', sendResponse);

            DOM.transferAnimation.addEventListener('click', () => {
                DOM.transferAnimation.style.display = 'none';
            });

            document.querySelectorAll('.btn-mode').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.dataset.mode;
                    const type = this.dataset.type;
                    selectMode(mode, type);
                });
            });

            let isRecording = false;
            DOM.recordAudioBtn.addEventListener('click', () => toggleRecording('audio', DOM.audioPreview, DOM.audioRecordingIndicator, DOM.audioBtnText));
            DOM.recordVideoBtn.addEventListener('click', () => toggleRecording('video', DOM.videoPreview, DOM.videoRecordingIndicator, DOM.videoBtnText));
            DOM.recordResponseAudioBtn.addEventListener('click', () => toggleRecording('response-audio', DOM.responseAudioPreview, DOM.responseAudioRecordingIndicator, DOM.responseAudioBtnText));
            DOM.recordResponseVideoBtn.addEventListener('click', () => toggleRecording('response-video', DOM.responseVideoPreview, DOM.responseVideoRecordingIndicator, DOM.responseVideoBtnText));
        }

        // Gestion de l'enregistrement audio/vidéo
        async function toggleRecording(type, previewElement, indicatorElement, btnTextElement) {
            if (!gameState.mediaRecorder || gameState.mediaRecorder.state === 'inactive') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia(
                        type.includes('audio') ? { audio: true } : { video: true, audio: true }
                    );
                    gameState.mediaRecorder = new MediaRecorder(stream);
                    gameState.recordedChunks = [];

                    gameState.mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            gameState.recordedChunks.push(event.data);
                        }
                    };

                    gameState.mediaRecorder.onstop = () => {
                        const blob = new Blob(gameState.recordedChunks, {
                            type: type.includes('audio') ? 'audio/webm' : 'video/webm'
                        });
                        previewElement.src = URL.createObjectURL(blob);
                        previewElement.style.display = 'block';
                        indicatorElement.style.display = 'none';
                        btnTextElement.textContent = type.includes('response') ? 
                            (type.includes('audio') ? 'Réenregistrer la réponse audio' : 'Réenregistrer la réponse vidéo') :
                            (type.includes('audio') ? 'Réenregistrer la question audio' : 'Réenregistrer la question vidéo');
                        addLog('system', `${type.includes('response') ? 'Réponse' : 'Question'} ${type.includes('audio') ? 'audio' : 'vidéo'} enregistrée`);
                        stream.getTracks().forEach(track => track.stop());
                    };

                    gameState.mediaRecorder.start();
                    indicatorElement.style.display = 'block';
                    btnTextElement.textContent = 'Arrêter l\'enregistrement';
                } catch (err) {
                    addLog('system', `Erreur lors de l'enregistrement ${type.includes('audio') ? 'audio' : 'vidéo'}: ${err.message}`);
                }
            } else {
                gameState.mediaRecorder.stop();
            }
        }

        // Mettre à jour l'interface
        function updateUI() {
            DOM.ablayAmount.textContent = `${(gameState.ablay / 1000)} mille`;
            DOM.kooloAmount.textContent = `${(gameState.koolo / 1000)} mille`;
            DOM.depotAmount.textContent = `${(gameState.depot / 1000)} mille`;
            document.getElementById('ablay-balance').textContent = gameState.ablay / 1000;
            document.getElementById('koolo-balance').textContent = gameState.koolo / 1000;
            document.getElementById('depot-balance').textContent = gameState.depot / 1000;

            updateGuestAccount();
            DOM.turnIndicator.textContent = capitalize(gameState.players[gameState.currentPlayerIndex]);
            DOM.askerTitle.textContent = `${capitalize(gameState.currentAsker)} - Pose la question`;

            const isAskerTurn = gameState.turn === 'ask';
            const isResponderTurn = gameState.turn === 'respond';
            const isValidationTurn = gameState.turn === 'validate';

            document.getElementById('ablay-question').disabled = !isAskerTurn;
            DOM.askBtn.disabled = !isAskerTurn;
            DOM.recordAudioBtn.disabled = !isAskerTurn;
            DOM.recordVideoBtn.disabled = !isAskerTurn;
            DOM.responseAnswer.disabled = !isResponderTurn;
            DOM.sendResponseBtn.disabled = !isResponderTurn;
            DOM.recordResponseAudioBtn.disabled = !isResponderTurn;
            DOM.recordResponseVideoBtn.disabled = !isResponderTurn;
            DOM.correctBtn.disabled = !isValidationTurn;
            DOM.wrongBtn.disabled = !isValidationTurn;
            DOM.refuseBtn.disabled = !isValidationTurn;

            DOM.gameStatus.textContent = isAskerTurn ? 
                `En attente d'une question de ${capitalize(gameState.currentAsker)}` :
                isResponderTurn ? 
                `${capitalize(gameState.currentResponder)} doit répondre à la question` :
                "En attente de validation de la réponse";

            updateGuestsList();
        }

        // Mettre à jour le compte invité
        function updateGuestAccount() {
            const totalGuestAmount = gameState.guests.reduce((sum, guest) => sum + guest.amount, 0);
            DOM.guestAmount.textContent = `${(totalGuestAmount / 1000)} mille`;
            document.getElementById('guest-balance').textContent = totalGuestAmount / 1000;

            if (gameState.guests.length > 0) {
                DOM.guestAccount.style.display = 'block';
                DOM.guestAccountTitle.textContent = gameState.guests.length > 1 ? 
                    `${gameState.guests.length} Invités` : '1 Invité';
            } else {
                DOM.guestAccount.style.display = 'none';
            }
        }

        // Mettre à jour la liste des invités
        function updateGuestsList() {
            DOM.guestsList.innerHTML = '';
            gameState.guests.forEach(guest => {
                const guestCard = document.createElement('div');
                guestCard.className = 'guest-card';
                guestCard.innerHTML = `
                    <i class="fas fa-user"></i>
                    <span class="guest-name">${guest.name}</span>
                    <span class="guest-amount">${guest.amount / 1000} mille</span>
                `;
                DOM.guestsList.appendChild(guestCard);
            });
            updateReceiverOptions();
        }

        // Mettre à jour les options du destinataire
        function updateReceiverOptions() {
            const currentReceiver = DOM.receiverSelect.value;
            DOM.receiverSelect.innerHTML = '<option value="koolo">Koolo</option>';
            gameState.guests.forEach(guest => {
                const option = document.createElement('option');
                option.value = guest.id;
                option.textContent = guest.name;
                DOM.receiverSelect.appendChild(option);
            });
            if (gameState.guests.some(guest => guest.id === currentReceiver)) {
                DOM.receiverSelect.value = currentReceiver;
            }
        }

        // Sélectionner un mode
        function selectMode(mode, type) {
            if (type === 'question') {
                gameState.currentMode = mode;
            } else {
                gameState.responseMode = mode;
            }

            document.querySelectorAll(`.btn-mode[data-type="${type}"]`).forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mode === mode) {
                    btn.classList.add('active');
                }
            });

            document.querySelectorAll(`.mode-section`).forEach(section => {
                section.classList.remove('active');
            });

            document.getElementById(`${mode}-${type}-section`).classList.add('active');
        }

        // Mettre à jour le tour
        function updatePlayerTurn() {
            gameState.currentAsker = gameState.players[gameState.currentPlayerIndex];
            gameState.turn = 'ask';
            updateUI();
        }

        // Poser une question
        function askQuestion() {
            let question;
            if (gameState.currentMode === 'text') {
                question = document.getElementById('ablay-question').value.trim();
                if (!question) {
                    addLog('system', 'Veuillez écrire une question !');
                    return;
                }
            } else if (gameState.currentMode === 'audio') {
                if (!DOM.audioPreview.src) {
                    addLog('system', 'Veuillez enregistrer un audio !');
                    return;
                }
                question = "Question audio";
            } else {
                if (!DOM.videoPreview.src) {
                    addLog('system', 'Veuillez enregistrer une vidéo !');
                    return;
                }
                question = "Question vidéo";
            }

            const receiver = DOM.receiverSelect.value;
            gameState.currentQuestion = {
                text: question,
                mode: gameState.currentMode,
                asker: gameState.currentAsker,
                media: gameState.currentMode !== 'text' ? (gameState.currentMode === 'audio' ? DOM.audioPreview.src : DOM.videoPreview.src) : null
            };

            gameState.currentResponder = receiver === 'koolo' ? 'koolo' : 
                gameState.guests.find(g => g.id === receiver)?.name || 'Inconnu';
            gameState.turn = 'respond';

            DOM.questionDisplay.style.display = 'block';
            if (gameState.currentMode === 'text') {
                DOM.currentQuestion.innerHTML = `
                    <div><strong>De:</strong> ${capitalize(gameState.currentAsker)}</div>
                    <div><strong>Mode:</strong> Texte</div>
                    <div>${question}</div>
                `;
            } else if (gameState.currentMode === 'audio') {
                DOM.currentQuestion.innerHTML = `
                    <div><strong>De:</strong> ${capitalize(gameState.currentAsker)}</div>
                    <div><strong>Mode:</strong> Audio</div>
                    <audio src="${DOM.audioPreview.src}" controls></audio>
                `;
            } else {
                DOM.currentQuestion.innerHTML = `
                    <div><strong>De:</strong> ${capitalize(gameState.currentAsker)}</div>
                    <div><strong>Mode:</strong> Vidéo</div>
                    <video src="${DOM.videoPreview.src}" controls width="100%"></video>
                `;
            }

            addLog(gameState.currentAsker, `A posé une question à ${gameState.currentResponder}`);
            document.getElementById('ablay-question').value = '';
            DOM.audioPreview.src = '';
            DOM.videoPreview.src = '';
            DOM.audioPreview.style.display = 'none';
            DOM.videoPreview.style.display = 'none';
            DOM.responderTitle.textContent = `${capitalize(gameState.currentResponder)} - Répond à la question`;
            updateUI();
        }

        // Envoyer la réponse
        function sendResponse() {
            let response;
            if (gameState.responseMode === 'text') {
                response = DOM.responseAnswer.value.trim();
                if (!response) {
                    addLog('system', 'Veuillez écrire une réponse !');
                    return;
                }
            } else if (gameState.responseMode === 'audio') {
                if (!DOM.responseAudioPreview.src) {
                    addLog('system', 'Veuillez enregistrer un audio !');
                    return;
                }
                response = "Réponse audio";
            } else {
                if (!DOM.responseVideoPreview.src) {
                    addLog('system', 'Veuillez enregistrer une vidéo !');
                    return;
                }
                response = "Réponse vidéo";
            }

            gameState.currentResponse = {
                text: response,
                mode: gameState.responseMode,
                responder: gameState.currentResponder,
                media: gameState.responseMode !== 'text' ? (gameState.responseMode === 'audio' ? DOM.responseAudioPreview.src : DOM.responseVideoPreview.src) : null
            };

            gameState.turn = 'validate';
            DOM.responseDisplay.style.display = 'block';

            if (gameState.responseMode === 'text') {
                DOM.currentResponse.innerHTML = `
                    <div><strong>De:</strong> ${capitalize(gameState.currentResponder)}</div>
                    <div><strong>Mode:</strong> Texte</div>
                    <div>${response}</div>
                `;
            } else if (gameState.responseMode === 'audio') {
                DOM.currentResponse.innerHTML = `
                    <div><strong>De:</strong> ${capitalize(gameState.currentResponder)}</div>
                    <div><strong>Mode:</strong> Audio</div>
                    <audio src="${DOM.responseAudioPreview.src}" controls></audio>
                `;
            } else {
                DOM.currentResponse.innerHTML = `
                    <div><strong>De:</strong> ${capitalize(gameState.currentResponder)}</div>
                    <div><strong>Mode:</strong> Vidéo</div>
                    <video src="${DOM.responseVideoPreview.src}" controls width="100%"></video>
                `;
            }

            addLog(gameState.currentResponder, `A répondu à la question`);
            DOM.responseAnswer.value = '';
            DOM.responseAudioPreview.src = '';
            DOM.responseVideoPreview.src = '';
            DOM.responseAudioPreview.style.display = 'none';
            DOM.responseVideoPreview.style.display = 'none';
            updateUI();
        }

        // Valider la réponse
        function validateAnswer(type) {
            let message = '';
            let amount = 0;
            const isGuest = !['ablay', 'koolo'].includes(gameState.currentResponder);
            const responder = isGuest ? gameState.guests.find(g => g.name === gameState.currentResponder) : null;

            switch (type) {
                case 'correct':
                    amount = 10000;
                    if (gameState.depot >= amount) {
                        if (isGuest && responder) {
                            responder.amount += amount;
                        } else if (gameState.currentResponder === 'ablay') {
                            gameState.ablay += amount;
                        } else {
                            gameState.koolo += amount;
                        }
                        gameState.depot -= amount;
                        message = `Bonne réponse ! ${capitalize(gameState.currentResponder)} gagne ${amount/1000} mille`;
                        showTransferAnimation(`+${amount/1000} mille`, 'positive');
                    } else {
                        message = 'Bonne réponse mais le dépôt est vide !';
                    }
                    break;

                case 'wrong':
                    amount = 5000;
                    if ((isGuest && responder && responder.amount >= amount) || 
                        (gameState.currentResponder === 'ablay' && gameState.ablay >= amount) || 
                        (gameState.currentResponder === 'koolo' && gameState.koolo >= amount)) {
                        if (isGuest && responder) {
                            responder.amount -= amount;
                        } else if (gameState.currentResponder === 'ablay') {
                            gameState.ablay -= amount;
                        } else {
                            gameState.koolo -= amount;
                        }
                        gameState.depot += amount;
                        message = `Mauvaise réponse ! ${capitalize(gameState.currentResponder)} perd ${amount/1000} mille`;
                        showTransferAnimation(`-${amount/1000} mille`, 'negative');
                    } else {
                        message = `${capitalize(gameState.currentResponder)} n'a pas assez d'argent !`;
                    }
                    break;

                case 'refuse':
                    amount = 20000;
                    if ((isGuest && responder && responder.amount >= amount) || 
                        (gameState.currentResponder === 'ablay' && gameState.ablay >= amount) || 
                        (gameState.currentResponder === 'koolo' && gameState.koolo >= amount)) {
                        if (isGuest && responder) {
                            responder.amount -= amount;
                        } else if (gameState.currentResponder === 'ablay') {
                            gameState.ablay -= amount;
                        } else {
                            gameState.koolo -= amount;
                        }
                        gameState.depot += amount;
                        message = `${capitalize(gameState.currentResponder)} a refusé de répondre ! Perte de ${amount/1000} mille`;
                        showTransferAnimation(`-${amount/1000} mille`, 'negative');
                    } else {
                        message = `${capitalize(gameState.currentResponder)} n'a pas assez d'argent pour refuser !`;
                    }
                    break;
            }

            addLog('system', message);
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            updatePlayerTurn();
            DOM.questionDisplay.style.display = 'none';
            DOM.responseDisplay.style.display = 'none';
            updateUI();
        }

        // Ajouter un message au journal
        function addLog(sender, message) {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const senderName = sender === 'system' ? 'Système' : capitalize(sender);

            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${sender}`;
            logEntry.innerHTML = `
                <div class="log-icon">
                    ${sender === 'ablay' ? '<i class="fas fa-crown"></i>' : 
                     sender === 'koolo' ? '<i class="fas fa-bullseye"></i>' : 
                     sender === 'system' ? '<i class="fas fa-info-circle"></i>' : 
                     '<i class="fas fa-user"></i>'}
                </div>
                <div class="log-content">
                    <div class="log-header">
                        <span>${senderName}</span>
                        <span>${timeString}</span>
                    </div>
                    <div>${message}</div>
                </div>
            `;
            DOM.logEntries.prepend(logEntry);
        }

        // Afficher l'animation de transfert
        function showTransferAnimation(amount, type) {
            DOM.transferAmount.textContent = amount;
            DOM.transferAmount.className = `transfer-amount ${type === 'negative' ? 'negative' : ''}`;
            DOM.transferAnimation.style.display = 'flex';
            setTimeout(() => {
                DOM.transferAnimation.style.display = 'none';
            }, 2000);
        }

        // Ajouter un invité
        function addGuest() {
            const guestName = document.getElementById('guest-name').value.trim();
            if (!guestName) {
                addLog('system', 'Veuillez entrer un nom pour l\'invité !');
                return;
            }

            if (gameState.guests.some(g => g.name.toLowerCase() === guestName.toLowerCase())) {
                addLog('system', 'Cet invité participe déjà au jeu !');
                return;
            }

            const newGuest = {
                id: 'guest' + Date.now(),
                name: guestName,
                amount: 0
            };

            gameState.guests.push(newGuest);
            gameState.players.push(newGuest.id);
            addLog('system', `Un invité a rejoint le jeu : ${guestName}`);
            document.getElementById('guest-name').value = '';
            updateUI();
        }

        // Capitaliser la première lettre
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Démarrer le jeu
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>



                
               
    <script>
        // Section 1: Responses System
        // Charger les réponses depuis le localStorage
        let responses = JSON.parse(localStorage.getItem('responses')) || [];
        
        const form = document.getElementById('responseForm');
        const textInput = document.getElementById('textResponse');
        const mediaInput = document.getElementById('mediaInput');
        const userNameInput = document.getElementById('userName');
        const responsesContainer = document.getElementById('responsesContainer');
        const noResponsesMessage = document.getElementById('noResponsesMessage');
        const clearResponsesBtn = document.getElementById('clearResponses');
        const confirmationMessage = document.getElementById('confirmationMessage');
        
        // Afficher les réponses au chargement de la page
        renderResponses();
        
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const userName = userNameInput.value.trim() || "Anonyme";
            const textValue = textInput.value.trim();
            const file = mediaInput.files[0];
            
            if (!textValue && !file) {
                showMessage('Merci d\'écrire un message ou choisir un fichier avant d\'envoyer.', 'error');
                return;
            }
            
            if (file) {
                const type = file.type.split('/')[0]; // image, audio, video
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    addResponse(userName, type, event.target.result, textValue);
                };
                
                reader.readAsDataURL(file);
            } else {
                addResponse(userName, 'text', textValue);
            }
        });
        
        function addResponse(userName, type, content, textContent = '') {
            const now = new Date();
            const response = {
                id: Date.now(),
                userName,
                type,
                content,
                textContent,
                timestamp: now.toLocaleString()
            };
            
            responses.push(response);
            saveResponses();
            renderResponses();
            
            // Afficher la confirmation d'envoi
            confirmationMessage.textContent = 'Message envoyé avec succès !';
            confirmationMessage.style.display = 'block';
            setTimeout(() => {
                confirmationMessage.style.display = 'none';
            }, 3000);
            
            // Reset form
            userNameInput.value = '';
            textInput.value = '';
            mediaInput.value = '';
        }
        
        function saveResponses() {
            localStorage.setItem('responses', JSON.stringify(responses));
        }
        
        function renderResponses() {
            if (responses.length === 0) {
                responsesContainer.innerHTML = '<div class="no-responses" id="noResponsesMessage">Aucune réponse pour le moment. Sois le premier à réagir !</div>';
                return;
            }
            
            noResponsesMessage.style.display = 'none';
            
            // Trier les réponses par date (les plus récentes en premier)
            responses.sort((a, b) => b.id - a.id);
            
            let html = '<h3>Réponses des visiteurs :</h3><div class="responses-grid">';
            
            responses.forEach(r => {
                html += `<div class="response-item">
                    <div class="response-header">
                        <span><strong>${escapeHtml(r.userName)}</strong></span>
                        <span>${r.timestamp}</span>
                    </div>`;
                
                if (r.textContent) {
                    html += `<div class="response-text">${escapeHtml(r.textContent)}</div>`;
                }
                
                if (r.type === 'image') {
                    html += `<div class="response-media"><img src="${r.content}" alt="Image envoyée" style="max-width:100%; border-radius:6px;"></div>`;
                } else if (r.type === 'audio') {
                    html += `<div class="response-media"><audio controls src="${r.content}" style="width:100%;"></audio></div>`;
                } else if (r.type === 'video') {
                    html += `<div class="response-media"><video controls src="${r.content}" style="width:100%; border-radius:6px;"></video></div>`;
                }
                
                html += `<button class="delete-btn" onclick="deleteResponse(${r.id})" title="Supprimer cette réponse">×</button>`;
                html += '</div>';
            });
            
            html += '</div>';
            responsesContainer.innerHTML = html;
        }
        
        function deleteResponse(id) {
            if (confirm('Voulez-vous vraiment supprimer cette réponse ?')) {
                responses = responses.filter(r => r.id !== id);
                saveResponses();
                renderResponses();
                confirmationMessage.textContent = 'Réponse supprimée avec succès !';
                confirmationMessage.style.display = 'block';
                setTimeout(() => {
                    confirmationMessage.style.display = 'none';
                }, 3000);
            }
        }
        
        // Éviter les injections XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Gestion du bouton d'effacement
        clearResponsesBtn.addEventListener('click', function() {
            if (confirm('Voulez-vous vraiment supprimer TOUTES les réponses ? Cette action est irréversible.')) {
                responses = [];
                localStorage.removeItem('responses');
                renderResponses();
                confirmationMessage.textContent = 'Toutes les réponses ont été supprimées !';
                confirmationMessage.style.display = 'block';
                setTimeout(() => {
                    confirmationMessage.style.display = 'none';
                }, 3000);
            }
        });

        // Fonction pour afficher les messages de confirmation
        function showMessage(message, type = 'success') {
            confirmationMessage.textContent = message;
            confirmationMessage.style.display = 'block';
            confirmationMessage.style.background = type === 'error' ? '#f44336' : '#4CAF50';
            
            // Cacher le message après 3 secondes
            setTimeout(() => {
                confirmationMessage.style.display = 'none';
            }, 3000);
        }

        // Initialisation
        window.addEventListener('DOMContentLoaded', function() {
            // Précharger tous les médias pour une lecture immédiate
            const mediaElements = document.querySelectorAll('audio, video');
            mediaElements.forEach(media => {
                media.preload = 'metadata';
            });
        });
        
        // Fonction pour naviguer vers les sections
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // ======================================
        // SECTION DU JEU
        // ======================================
        
        // État du jeu
        const gameState = {
            depot: 50000,
            ablay: 0,
            koolo: 0,
            guests: [],
            currentQuestion: null,
            currentResponses: {},
            pendingResponders: [],
            turn: 'ask',
            transactions: 0,
            currentAsker: 'ablay',
            players: ['ablay', 'koolo'],
            currentPlayerIndex: 0
        };
        
        // Éléments DOM du jeu
        const DOMGame = {
            ablayAmount: document.getElementById('ablay-amount'),
            kooloAmount: document.getElementById('koolo-amount'),
            depotAmount: document.getElementById('depot-amount'),
            guestAmount: document.getElementById('guest-amount'),
            ablayAccount: document.getElementById('ablay-account'),
            kooloAccount: document.getElementById('koolo-account'),
            guestAccount: document.getElementById('guest-account'),
            askBtn: document.getElementById('ask-btn'),
            correctBtn: document.getElementById('correct-btn'),
            wrongBtn: document.getElementById('wrong-btn'),
            refuseBtn: document.getElementById('refuse-btn'),
            questionDisplay: document.getElementById('question-display'),
            currentQuestion: document.getElementById('current-question'),
            responseDisplay: document.getElementById('response-display'),
            logEntries: document.getElementById('log-entries'),
            turnIndicator: document.getElementById('turn-indicator'),
            gameStatus: document.getElementById('game-status'),
            transferAnimation: document.getElementById('transfer-animation'),
            transferAmount: document.getElementById('transfer-amount'),
            askerTitle: document.getElementById('asker-title'),
            responderTitle: document.getElementById('responder-title'),
            sendResponseBtn: document.getElementById('send-response-btn'),
            addGuestBtn: document.getElementById('add-guest-btn'),
            questionStatus: document.getElementById('questionStatus'),
            guestsList: document.getElementById('guests-list'),
            guestAccountTitle: document.getElementById('guest-account-title')
        };
        
        let currentRecorder;
        let currentStream;
        let chunks = [];
        
        // Initialisation du jeu
        function initGame() {
            updateUIGame();
            setupEventListenersGame();
            updatePlayerTurn();
            updateQuestionInput();
        }
        
        // Configuration des écouteurs d'événements du jeu
        function setupEventListenersGame() {
            DOMGame.askBtn.addEventListener('click', askQuestion);
            DOMGame.sendResponseBtn.addEventListener('click', sendResponse);
            DOMGame.addGuestBtn.addEventListener('click', addGuest);
            document.getElementById('question-type').addEventListener('change', updateQuestionInput);
            
            DOMGame.transferAnimation.addEventListener('click', () => {
                DOMGame.transferAnimation.style.display = 'none';
            });
        }
        
        // Mettre à jour l'interface du jeu
        function updateUIGame() {
            DOMGame.ablayAmount.textContent = `${gameState.ablay / 1000} mille`;
            DOMGame.kooloAmount.textContent = `${gameState.koolo / 1000} mille`;
            DOMGame.depotAmount.textContent = `${gameState.depot / 1000} mille`;
            document.getElementById('ablay-balance').textContent = gameState.ablay / 1000;
            document.getElementById('koolo-balance').textContent = gameState.koolo / 1000;
            document.getElementById('depot-balance').textContent = gameState.depot / 1000;

            updateGuestAccount();
            DOMGame.turnIndicator.textContent = capitalize(getName(gameState.players[gameState.currentPlayerIndex]));
            DOMGame.askerTitle.textContent = `${capitalize(getName(gameState.currentAsker))} - Pose la question`;

            const isAskTurn = gameState.turn === 'ask';
            const isRespondTurn = gameState.turn === 'respond';
            const isValidateTurn = gameState.turn === 'validate';

            DOMGame.askBtn.disabled = !isAskTurn;
            DOMGame.sendResponseBtn.disabled = !isRespondTurn;
            DOMGame.correctBtn.disabled = true; // Managed per response
            DOMGame.wrongBtn.disabled = true;
            DOMGame.refuseBtn.disabled = true;

            DOMGame.gameStatus.textContent = isAskTurn ? 
                `En attente d'une question de ${capitalize(getName(gameState.currentAsker))}` :
                isRespondTurn ? 
                `Les répondants doivent répondre à la question` :
                "En attente de validation des réponses";

            if (isRespondTurn) {
                const pending = gameState.pendingResponders || [];
                const selectGroup = document.getElementById('responder-select-group');
                if (pending.length > 1) {
                    selectGroup.style.display = 'block';
                    const select = document.getElementById('responder-select');
                    select.innerHTML = pending.map(p => `<option value="${p}">${capitalize(getName(p))}</option>`).join('');
                } else {
                    selectGroup.style.display = 'none';
                }
                updateResponseInput(gameState.currentQuestion ? gameState.currentQuestion.type : 'text');
                displayQuestion();
            } else if (isValidateTurn) {
                displayResponses();
            }

            document.querySelectorAll('.account').forEach(a => a.classList.remove('active'));
            const askerAccountId = `${gameState.currentAsker}-account`;
            const askerAccount = document.getElementById(askerAccountId);
            if (askerAccount) askerAccount.classList.add('active');

            updateGuestsList();
        }
        
        // Mettre à jour le compte invité
        function updateGuestAccount() {
            const totalGuestAmount = gameState.guests.reduce((sum, guest) => sum + guest.amount, 0);
            DOMGame.guestAmount.textContent = `${totalGuestAmount / 1000} mille`;
            document.getElementById('guest-balance').textContent = totalGuestAmount / 1000;

            if (gameState.guests.length > 0) {
                DOMGame.guestAccount.style.display = 'block';
                DOMGame.guestAccountTitle.textContent = gameState.guests.length > 1 ? 
                    `${gameState.guests.length} Invités` : '1 Invité';
            } else {
                DOMGame.guestAccount.style.display = 'none';
            }
        }
        
        // Mettre à jour la liste des invités
        function updateGuestsList() {
            DOMGame.guestsList.innerHTML = '';
            gameState.guests.forEach(guest => {
                const guestCard = document.createElement('div');
                guestCard.className = 'guest-card';
                guestCard.innerHTML = `
                    <i class="fas fa-user"></i>
                    <span class="guest-name">${guest.name}</span>
                    <span class="guest-amount">${guest.amount / 1000} mille</span>
                `;
                DOMGame.guestsList.appendChild(guestCard);
            });
        }
        
        // Mettre à jour le tour du joueur
        function updatePlayerTurn() {
            gameState.currentAsker = gameState.players[gameState.currentPlayerIndex];
            gameState.turn = 'ask';
            gameState.currentQuestion = null;
            gameState.currentResponses = {};
            gameState.pendingResponders = [];
            DOMGame.questionDisplay.style.display = 'none';
            DOMGame.responseDisplay.style.display = 'none';
            DOMGame.questionStatus.style.display = 'none';
            updateUIGame();
        }
        
        // Mettre à jour l'input de question
        function updateQuestionInput() {
            const type = document.getElementById('question-type').value;
            const container = document.getElementById('question-input');
            container.innerHTML = '';
            if (type === 'text') {
                const ta = document.createElement('textarea');
                ta.id = 'question-text';
                ta.placeholder = 'Écris ta question ici...';
                container.appendChild(ta);
            } else {
                const previewTag = type;
                container.innerHTML = `
                    <${previewTag} id="question-preview" controls></${previewTag}>
                    <button id="question-start-record" class="btn btn-primary"><i class="fas fa-microphone"></i> Enregistrer ${type === 'audio' ? 'audio' : 'vidéo'}</button>
                    <button id="question-stop-record" class="btn btn-warning" style="display:none;"><i class="fas fa-stop"></i> Stop</button>
                `;
                document.getElementById('question-start-record').onclick = () => startRecording(type, 'question');
                document.getElementById('question-stop-record').onclick = () => stopRecording('question');
            }
        }
        
        // Mettre à jour l'input de réponse
        function updateResponseInput(type) {
            const container = document.getElementById('response-input');
            container.innerHTML = '';
            if (type === 'text') {
                const ta = document.createElement('textarea');
                ta.id = 'response-text';
                ta.placeholder = 'Écris ta réponse ici...';
                container.appendChild(ta);
            } else {
                const previewTag = type;
                container.innerHTML = `
                    <${previewTag} id="response-preview" controls></${previewTag}>
                    <button id="response-start-record" class="btn btn-primary"><i class="fas fa-microphone"></i> Enregistrer ${type === 'audio' ? 'audio' : 'vidéo'}</button>
                    <button id="response-stop-record" class="btn btn-warning" style="display:none;"><i class="fas fa-stop"></i> Stop</button>
                `;
                document.getElementById('response-start-record').onclick = () => startRecording(type, 'response');
                document.getElementById('response-stop-record').onclick = () => stopRecording('response');
            }
        }
        
        // Démarrer l'enregistrement
        function startRecording(type, prefix) {
            const constraints = { audio: true, video: type === 'video' };
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    currentStream = stream;
                    currentRecorder = new MediaRecorder(stream);
                    chunks = [];
                    currentRecorder.ondataavailable = e => chunks.push(e.data);
                    currentRecorder.onstop = () => {
                        const blobType = type === 'audio' ? 'audio/mpeg' : 'video/mp4';
                        const blob = new Blob(chunks, { type: blobType });
                        const reader = new FileReader();
                        reader.readAsDataURL(blob);
                        reader.onloadend = () => {
                            document.getElementById(`${prefix}-preview`).src = reader.result;
                        };
                    };
                    currentRecorder.start();
                    document.getElementById(`${prefix}-start-record`).style.display = 'none';
                    document.getElementById(`${prefix}-stop-record`).style.display = 'inline-flex';
                    const preview = document.getElementById(`${prefix}-preview`);
                    if (type === 'video') {
                        preview.srcObject = stream;
                        preview.play();
                    }
                })
                .catch(err => {
                    console.error('Erreur d\'accès au média:', err);
                    addLog('system', 'Impossible d\'accès au microphone/caméra. Vérifiez les permissions.');
                });
        }
        
        // Arrêter l'enregistrement
        function stopRecording(prefix) {
            if (currentRecorder) currentRecorder.stop();
            if (currentStream) currentStream.getTracks().forEach(track => track.stop());
            document.getElementById(`${prefix}-start-record`).style.display = 'inline-flex';
            document.getElementById(`${prefix}-stop-record`).style.display = 'none';
            const preview = document.getElementById(`${prefix}-preview`);
            if (preview.srcObject) preview.srcObject = null;
        }
        
        // Poser une question
        function askQuestion() {
            const type = document.getElementById('question-type').value;
            let content;
            if (type === 'text') {
                content = document.getElementById('question-text').value.trim();
            } else {
                content = document.getElementById('question-preview').src;
            }
            if (!content) {
                addLog('system', 'Veuillez fournir une question !');
                return;
            }
            gameState.currentQuestion = { type, content };
            gameState.pendingResponders = gameState.players.filter(p => p !== gameState.currentAsker);
            gameState.currentResponses = {};
            gameState.turn = 'respond';
            DOMGame.questionDisplay.style.display = 'block';
            addLog(gameState.currentAsker, 'A posé une question');
            DOMGame.questionStatus.textContent = 'Question envoyée';
            DOMGame.questionStatus.className = 'question-status question-asked';
            DOMGame.questionStatus.style.display = 'block';
            updateUIGame();
        }
        
        // Afficher la question
        function displayQuestion() {
            const q = gameState.currentQuestion;
            if (!q) return;
            DOMGame.currentQuestion.innerHTML = '';
            if (q.type === 'text') {
                DOMGame.currentQuestion.textContent = q.content;
            } else {
                const elem = document.createElement(q.type);
                elem.src = q.content;
                elem.controls = true;
                DOMGame.currentQuestion.appendChild(elem);
            }
        }
        
        // Envoyer la réponse
        function sendResponse() {
            const type = gameState.currentQuestion.type;
            let content;
            if (type === 'text') {
                content = document.getElementById('response-text').value.trim();
            } else {
                content = document.getElementById('response-preview').src;
            }
            if (!content) {
                addLog('system', 'Veuillez fournir une réponse !');
                return;
            }
            let pending = gameState.pendingResponders;
            let selected;
            if (pending.length > 1) {
                selected = document.getElementById('responder-select').value;
            } else if (pending.length === 1) {
                selected = pending[0];
            } else {
                return;
            }
            gameState.currentResponses[selected] = { type, content };
            gameState.pendingResponders = pending.filter(p => p !== selected);
            addLog(selected, 'A répondu à la question');
            if (gameState.pendingResponders.length === 0) {
                gameState.turn = 'validate';
            }
            DOMGame.questionStatus.textContent = 'Question répondue';
            DOMGame.questionStatus.className = 'question-status question-answered';
            DOMGame.questionStatus.style.display = 'block';
            updateResponseInput(type);
            updateUIGame();
        }
        
        // Afficher les réponses pour validation
        function displayResponses() {
            DOMGame.responseDisplay.innerHTML = '<strong>Réponses reçues :</strong>';
            for (let key in gameState.currentResponses) {
                const res = gameState.currentResponses[key];
                const div = document.createElement('div');
                div.className = 'response-item';
                div.innerHTML = `<div><strong>Réponse de ${capitalize(getName(key))} :</strong></div>`;
                const mediaDiv = document.createElement('div');
                if (res.type === 'text') {
                    mediaDiv.textContent = res.content;
                } else {
                    const elem = document.createElement(res.type);
                    elem.src = res.content;
                    elem.controls = true;
                    mediaDiv.appendChild(elem);
                }
                div.appendChild(mediaDiv);
                const actions = document.createElement('div');
                actions.className = 'response-actions';
                const correct = document.createElement('button');
                correct.className = 'btn btn-primary';
                correct.innerHTML = '<i class="fas fa-check-circle"></i> Bonne';
                correct.onclick = () => validateAnswer('correct', key);
                const wrong = document.createElement('button');
                wrong.className = 'btn btn-warning';
                wrong.innerHTML = '<i class="fas fa-times-circle"></i> Mauvaise';
                wrong.onclick = () => validateAnswer('wrong', key);
                const refuse = document.createElement('button');
                refuse.className = 'btn';
                refuse.style.background = 'linear-gradient(to right, #607D8B, #37474F)';
                refuse.innerHTML = '<i class="fas fa-ban"></i> Refuser';
                refuse.onclick = () => validateAnswer('refuse', key);
                actions.appendChild(correct);
                actions.appendChild(wrong);
                actions.appendChild(refuse);
                div.appendChild(actions);
                DOMGame.responseDisplay.appendChild(div);
            }
            DOMGame.responseDisplay.style.display = 'block';
        }
        
        // Valider une réponse
        function validateAnswer(validationType, responderKey) {
            let message = '';
            let amount = 0;
            const isGuest = gameState.guests.some(g => g.id === responderKey);
            const responder = isGuest ? gameState.guests.find(g => g.id === responderKey) : null;
            let responderAmount = isGuest ? responder.amount : gameState[responderKey];
            
            switch (validationType) {
                case 'correct':
                    amount = 10000;
                    if (gameState.depot >= amount) {
                        if (isGuest) {
                            responder.amount += amount;
                        } else {
                            gameState[responderKey] += amount;
                        }
                        gameState.depot -= amount;
                        message = `Bonne réponse ! ${capitalize(getName(responderKey))} gagne ${amount / 1000} mille`;
                        showTransferAnimation(`+${amount / 1000} mille`, 'positive');
                    } else {
                        message = 'Bonne réponse mais le dépôt est vide !';
                    }
                    break;
                case 'wrong':
                    amount = 5000;
                    if (responderAmount >= amount) {
                        if (isGuest) {
                            responder.amount -= amount;
                        } else {
                            gameState[responderKey] -= amount;
                        }
                        gameState.depot += amount;
                        message = `Mauvaise réponse ! ${capitalize(getName(responderKey))} perd ${amount / 1000} mille`;
                        showTransferAnimation(`-${amount / 1000} mille`, 'negative');
                    } else {
                        message = `${capitalize(getName(responderKey))} n'a pas assez d'argent !`;
                    }
                    break;
                case 'refuse':
                    amount = 20000;
                    if (responderAmount >= amount) {
                        if (isGuest) {
                            responder.amount -= amount;
                        } else {
                            gameState[responderKey] -= amount;
                        }
                        gameState.depot += amount;
                        message = `Réponse refusée ! ${capitalize(getName(responderKey))} perd ${amount / 1000} mille`;
                        showTransferAnimation(`-${amount / 1000} mille`, 'negative');
                    } else {
                        message = `${capitalize(getName(responderKey))} n'a pas assez d'argent pour refuser !`;
                    }
                    break;
            }

            addLog('system', message);
            delete gameState.currentResponses[responderKey];
            if (Object.keys(gameState.currentResponses).length === 0) {
                gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
                updatePlayerTurn();
            }
            updateUIGame();
        }
        
        // Ajouter un message au journal
        function addLog(senderKey, message) {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const senderName = senderKey === 'system' ? 'Système' : capitalize(getName(senderKey));
            const className = senderKey === 'system' ? 'system' : getName(senderKey).toLowerCase() === 'ablay' ? 'ablay' : getName(senderKey).toLowerCase() === 'koolo' ? 'koolo' : 'guest';

            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${className}`;
            logEntry.innerHTML = `
                <div class="log-icon">
                    ${senderKey === 'ablay' ? '<i class="fas fa-crown"></i>' : 
                      senderKey === 'koolo' ? '<i class="fas fa-bullseye"></i>' : 
                      senderKey === 'system' ? '<i class="fas fa-info-circle"></i>' : 
                      '<i class="fas fa-user"></i>'}
                </div>
                <div class="log-content">
                    <div class="log-header">
                        <span>${senderName}</span>
                        <span>${timeString}</span>
                    </div>
                    <div>${message}</div>
                </div>
            `;
            DOMGame.logEntries.prepend(logEntry);
        }
        
        // Afficher l'animation de transfert
        function showTransferAnimation(amount, type) {
            DOMGame.transferAmount.textContent = amount;
            DOMGame.transferAmount.className = `transfer-amount ${type === 'negative' ? 'negative' : ''}`;
            DOMGame.transferAnimation.style.display = 'flex';
            setTimeout(() => {
                DOMGame.transferAnimation.style.display = 'none';
            }, 2000);
        }
        
        // Ajouter un invité
        function addGuest() {
            const guestName = document.getElementById('guest-name').value.trim();
            if (!guestName) {
                addLog('system', 'Veuillez entrer un nom pour l\'invité !');
                return;
            }

            if (gameState.guests.some(g => g.name.toLowerCase() === guestName.toLowerCase())) {
                addLog('system', 'Cet invité participe déjà au jeu !');
                return;
            }

            const newGuest = {
                id: 'guest' + Date.now(),
                name: guestName,
                amount: 0
            };

            gameState.guests.push(newGuest);
            gameState.players.push(newGuest.id);
            addLog('system', `Un invité a rejoint le jeu : ${guestName}`);
            document.getElementById('guest-name').value = '';
            updateUIGame();
        }
        
        // Obtenir le nom du joueur
        function getName(key) {
            if (key === 'ablay') return 'ablay';
            if (key === 'koolo') return 'koolo';
            const guest = gameState.guests.find(g => g.id === key);
            return guest ? guest.name : 'inconnu';
        }
        
        // Capitaliser la première lettre
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        // Démarrer le jeu
        window.addEventListener('DOMContentLoaded', function() {
            // Précharger tous les médias pour une lecture immédiate
            const mediaElements = document.querySelectorAll('audio, video');
            mediaElements.forEach(media => {
                media.preload = 'metadata';
            });
            
            initGame();
        });
    </script>



               
   

</body>
</html>





